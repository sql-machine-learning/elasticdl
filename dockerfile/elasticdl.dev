FROM tensorflow/tensorflow:1.13.1-py3
# For GPU version, use:
# FROM tensorflow/tensorflow:1.13.1-gpu-py3
# for pytorch, use:
# FROM pytorch/pytorch

RUN apt-get update
RUN apt-get install -y unzip curl

# Install gRPC tools in Python
RUN pip install grpcio-tools

# Install the Kubernetes Python client
RUN pip install kubernetes

# Install RecordIO and its dependency
RUN apt-get install -y libsnappy-dev && \
    pip install pyrecordio docker

ENV PYTHONPATH=/

# RecordIO dataset generator
COPY recordio_ds_gen /recordio_ds_gen  
COPY record_codec /elasticdl/record_codec
RUN python /recordio_ds_gen/mnist/gen_data.py --codec-type tf_example /data
RUN python /recordio_ds_gen/cifar10/gen_data.py /data

WORKDIR /
COPY elasticdl /elasticdl
COPY Makefile /Makefile
RUN make
