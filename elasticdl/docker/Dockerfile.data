ARG BASE_IMAGE=tensorflow/tensorflow:2.0.0b0-py3
FROM ${BASE_IMAGE}

RUN apt-get update && apt-get install -y unzip curl

ARG EXTRA_PYPI_INDEX

# Install RecordIO
RUN pip install 'pyrecordio>=0.0.6' --extra-index-url=${EXTRA_PYPI_INDEX}

COPY elasticdl/python/data /elasticdl/python/data
COPY elasticdl/python/elasticdl/common /elasticdl/python/elasticdl/common

ENV PYTHONPATH=/
WORKDIR /
RUN python elasticdl/python/data/recordio_gen/mnist/gen_data.py /data && \
 python elasticdl/python/data/recordio_gen/cifar10/gen_data.py /data && \
 rm -rf /root/.keras/datasets # To save about 350MB.

COPY elasticdl/docker/bashrc /etc/bash.bashrc
RUN chmod a+rwx /etc/bash.bashrc
